{
  "description": "Pipeline for parsing nomad error logs",
  "processors": [{
      "grok": {
        "field": "message",
        "patterns":[
          "\\s*%{TIMESTAMP_ISO8601:nomad.log.timestamp} \\[%{WORD:nomad.log.severity}\\] %{GREEDYDATA:nomad.log.message}"
        ],
        "ignore_missing": true
      }
    },
    {
      "remove": {
        "field": "message"
      }
    },
    {
      "date": {
        "field": "nomad.log.timestamp",
        "target_field": "@timestamp",
        "formats": ["ISO8601"]
      }
    },
    {
      "remove": {
        "field": "nomad.log.timestamp"
      }
    }],
    "on_failure" : [{
      "set" : {
        "field" : "error.message",
        "value" : "{{ _ingest.on_failure_message }}"
      }
  }]
}